<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>后台管理</title>
    <meta name="viewport" content="initial-scale=1, width=device-width, maximum-scale=1, user-scalable=no">
    <link type="text/css" rel="stylesheet" href="/TSC/resources/css/reset/reset.css">
    <link type="text/css" rel="stylesheet" href="/TSC/resources/css/manage-background/ps-index.css" >
    <link href="/TSC/resources/css/bootstrap.css" rel="stylesheet">
    <link href="/TSC/resources/css/manage-background/createValidity.css" rel="stylesheet" type="text/css">
</head>

<body>
<div class="">
    #parse("lcjxjd_back/ps-index-header.html")

    <div class="row" id="content">
        <div class="main-side-nav">
             #parse("lcjxjd_back/ps-index-left.html")
        </div>


        <div class="right-content row">

            <div class="tab col-sm-12 mt20">
                <div class="col-sm-12">

                    <table class="table table-hover table-bordered mt20">
                        <thead>
                            <tr>
                                <td class="th w700">项目</td>
                                <td class="th">专家</td>
                            </tr>
                        </thead>

                        <tbody>
                        #foreach($project in $!projects)
                            <tr>
                            	<input type="hidden" name="project_id" value="$!project.id"/>
                                <td class="tc">$!project.name</td>

                                <td class="tc">
                                    <select class="expert-select-one">
                                    #foreach($expert in $!experts)
                                        <option value ="$!expert.id">$!expert.trueName</option>
                                    #end
                                    </select>
                                </td>

                            </tr> 
                         #end
                        </tbody>
                    </table>
                        <input type="button" id="btn_assign" style="float:right;" value="保存"/>

                </div>
            </div>
        </div><!--<div class="col-md-11 right-content row">-->
    </div>
    <!--end <div class="row" id="content">-->
</div>

<script src="/TSC/resources/js/jquery-1.10.2.min.js" type="text/javascript"></script>
<script src="/TSC/resources/js/bootstrap.min.js" type="text/javascript"></script>

<!--建议手动加在语言，避免在ie下有时因为加载语言失败导致编辑器加载失败-->
<!--这里加载的语言文件会覆盖你在配置项目里添加的语言类型，比如你在配置项目里配置的是英文，这里加载的中文，那最后就是中文-->
<script src="/TSC/resources/js/manege-back/ps-tab.js" type="text/javascript"></script>

<script type="text/javascript">
	var expertArray = new Array();
	var expertNameArray = new Array();
	$(".expert-select-one").eq(0).find("option").each(function(){
		expertArray.push($(this).val());
		expertNameArray.push($(this).text()); 
	});
	
	$(document).ready(function(){
		$("#btn_assign").click(function(){
			var user_ids = "";
			$(".expert-select-one").each(function(){
				user_ids += $(this).val()+",";
			});
			$(".expert-select-two").each(function(){
				user_ids += $(this).val()+",";
			});
			var project_ids = "";
			$("input[name='project_id']").each(function(){
				project_ids += $(this).val()+",";
			});
			project_ids += project_ids;
			
			jQuery.ajax({
				url:'batchAssignExpert.htm',
				type:'post',
				data:{project_ids:project_ids,user_ids:user_ids},
				success:function(){
					window.location.href = "bg_index.htm";
				},
				error:function(){
	    			alert("对不起网络延迟，暂时无法加载信息");
	    		}
			});
			
		});
		
		$(".expert-select-one").change(function(){
			//$(this).each(function(index){
				var userId1 = $(this).val();
				//alert(index);
				$(".expert-select-two option").remove();
				for(var i=0; i<expertArray.length; i++){
					$(".expert-select-two").append("<option value='" + expertArray[i]+"'>" + expertNameArray[i]+ "</option>");
				} 
				$(".expert-select-two option").each(function(){
					if($(this).val() == userId1){
						$(this).remove();
					}
				}); 
			//});
		});
	});
</script>

</body>
</html>